-- [[ Script Avançado - Universal Hub ]]
-- Otimizado para performance, estabilidade e discreção

local function GetLib()
    local success, result = pcall(function()
        return loadstring(game:HttpGet("https://raw.githubusercontent.com/rawstudios/StudiosLib/refs/heads/main/StudiosLib"))()
    end)
    return success and result or nil
end

local StudiosLib = GetLib()
if not StudiosLib then return end

-- // Configurações de Ambiente
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- // Configurações Internas (Discretas)
local ProfileSettings = {
    Aim = {
        Active = false,
        CheckTeam = true,
        CheckWall = true,
        Smooth = 5,
        Part = "Head",
        Predict = false,
        PredictValue = 0.165,
        Sticky = false,
        CircleShow = true,
        CircleSize = 100,
        CircleColor = Color3.fromRGB(0, 255, 0),
        Blacklist = {}
    },
    Visuals = {
        Active = false,
        Box = false,
        Label = false,
        Line = false,
        Dist = false,
        Team = true,
        TeamColorMode = false,
        RainbowMode = false,
        BaseColor = Color3.fromRGB(255, 255, 255)
    }
}

-- // Ajudantes de Renderização
local FOV_Indicator = Drawing.new("Circle")
FOV_Indicator.Thickness = 1
FOV_Indicator.NumSides = 60
FOV_Indicator.Filled = false
FOV_Indicator.Transparency = 0.8
FOV_Indicator.Color = ProfileSettings.Aim.CircleColor

local Cache_ESP = {}

local function InitESP(P)
    if Cache_ESP[P] then return end
    Cache_ESP[P] = {
        B = Drawing.new("Square"),
        N = Drawing.new("Text"),
        L = Drawing.new("Line"),
        D = Drawing.new("Text")
    }
    local o = Cache_ESP[P]
    o.B.Thickness = 1
    o.B.Visible = false
    o.N.Size = 16
    o.N.Center = true
    o.N.Outline = true
    o.N.Visible = false
    o.D.Size = 13
    o.D.Center = true
    o.D.Outline = true
    o.D.Visible = false
    o.L.Thickness = 1
    o.L.Visible = false
end

local function CleanupESP(P)
    if Cache_ESP[P] then
        for _, v in pairs(Cache_ESP[P]) do v:Remove() end
        Cache_ESP[P] = nil
    end
end

-- // Lógica de Mira
local LockTarget = nil

local function FetchTarget()
    if ProfileSettings.Aim.Sticky and LockTarget then
        if LockTarget.Parent and LockTarget.Parent:FindFirstChild("Humanoid") and LockTarget.Parent.Humanoid.Health > 0 then
            local pos, vis = Camera:WorldToViewportPoint(LockTarget.Position)
            if vis and (Vector2.new(pos.X, pos.Y) - UserInputService:GetMouseLocation()).Magnitude < ProfileSettings.Aim.CircleSize then
                return LockTarget
            end
        end
        LockTarget = nil
    end

    local best = nil
    local dist = ProfileSettings.Aim.CircleSize
    
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") and p.Character.Humanoid.Health > 0 then
            if ProfileSettings.Aim.CheckTeam and p.Team == LocalPlayer.Team then continue end
            if p.Team and ProfileSettings.Aim.Blacklist[p.Team.Name] then continue end
            
            local tPart = p.Character:FindFirstChild(ProfileSettings.Aim.Part) or p.Character:FindFirstChild("HumanoidRootPart")
            if not tPart then continue end
            
            local pos, vis = Camera:WorldToViewportPoint(tPart.Position)
            if vis then
                local mDist = (Vector2.new(pos.X, pos.Y) - UserInputService:GetMouseLocation()).Magnitude
                if mDist < dist then
                    if ProfileSettings.Aim.CheckWall then
                        local params = RaycastParams.new()
                        params.FilterType = Enum.RaycastFilterType.Blacklist
                        params.FilterDescendantsInstances = {LocalPlayer.Character, Camera}
                        local res = workspace:Raycast(Camera.CFrame.Position, (tPart.Position - Camera.CFrame.Position).Unit * 500, params)
                        if res and res.Instance:IsDescendantOf(p.Character) then
                            dist = mDist
                            best = tPart
                        end
                    else
                        dist = mDist
                        best = tPart
                    end
                end
            end
        end
    end
    LockTarget = best
    return best
end

-- // Loop Principal
RunService.RenderStepped:Connect(function()
    FOV_Indicator.Visible = ProfileSettings.Aim.CircleShow
    FOV_Indicator.Radius = ProfileSettings.Aim.CircleSize
    FOV_Indicator.Position = UserInputService:GetMouseLocation()
    FOV_Indicator.Color = ProfileSettings.Aim.CircleColor
    
    if ProfileSettings.Aim.Active and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
        local t = FetchTarget()
        if t then
            local p = t.Position
            if ProfileSettings.Aim.Predict then
                p = p + (t.Parent.HumanoidRootPart.Velocity * ProfileSettings.Aim.PredictValue)
            end
            Camera.CFrame = Camera.CFrame:Lerp(CFrame.new(Camera.CFrame.Position, p), 1 / ProfileSettings.Aim.Smooth)
        end
    end

    for _, p in pairs(Players:GetPlayers()) do
        InitESP(p)
        local o = Cache_ESP[p]
        local c = p.Character
        local v = false
        
        if ProfileSettings.Visuals.Active and p ~= LocalPlayer and c and c:FindFirstChild("HumanoidRootPart") and c.Humanoid.Health > 0 then
            if not (ProfileSettings.Visuals.Team and p.Team == LocalPlayer.Team) then
                local root = c.HumanoidRootPart
                local head = c:FindFirstChild("Head")
                if head then
                    local rPos, rVis = Camera:WorldToViewportPoint(root.Position)
                    local hPos = Camera:WorldToViewportPoint(head.Position + Vector3.new(0, 0.5, 0))
                    local lPos = Camera:WorldToViewportPoint(root.Position - Vector3.new(0, 3, 0))
                    
                    if rVis then
                        v = true
                        local col = ProfileSettings.Visuals.BaseColor
                        if ProfileSettings.Visuals.RainbowMode then
                            col = Color3.fromHSV(tick() % 5 / 5, 1, 1)
                        elseif ProfileSettings.Visuals.TeamColorMode and p.Team then
                            col = p.TeamColor.Color
                        end
                        
                        if ProfileSettings.Visuals.Box then
                            local h = math.abs(hPos.Y - lPos.Y)
                            local w = h / 1.5
                            o.B.Size = Vector2.new(w, h)
                            o.B.Position = Vector2.new(rPos.X - w / 2, rPos.Y - h / 2)
                            o.B.Color = col
                            o.B.Visible = true
                        else o.B.Visible = false end
                        
                        if ProfileSettings.Visuals.Label then
                            o.N.Text = p.Name
                            o.N.Position = Vector2.new(rPos.X, rPos.Y - (math.abs(hPos.Y - lPos.Y) / 2) - 20)
                            o.N.Color = col
                            o.N.Visible = true
                        else o.N.Visible = false end
                        
                        if ProfileSettings.Visuals.Dist then
                            local d = math.floor((root.Position - Camera.CFrame.Position).Magnitude)
                            o.D.Text = "[" .. d .. "m]"
                            o.D.Position = Vector2.new(rPos.X, rPos.Y + (math.abs(hPos.Y - lPos.Y) / 2) + 5)
                            o.D.Color = col
                            o.D.Visible = true
                        else o.D.Visible = false end
                        
                        if ProfileSettings.Visuals.Line then
                            o.L.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
                            o.L.To = Vector2.new(rPos.X, rPos.Y)
                            o.L.Color = col
                            o.L.Visible = true
                        else o.L.Visible = false end
                    end
                end
            end
        end
        if not v then
            o.B.Visible = false; o.N.Visible = false; o.D.Visible = false; o.L.Visible = false
        end
    end
end)

Players.PlayerRemoving:Connect(CleanupESP)

-- // Gerenciamento da UI (Idiomas e Stealth)
local MainUI = StudiosLib:CreateWindow("StudiosLib | Hub Universal")

local T_Aim = MainUI:CreateTab("Principal")
T_Aim:AddToggle("Ativar Mira (Aimbot)", false, function(s) ProfileSettings.Aim.Active = s end)
T_Aim:AddToggle("Verificar Time", true, function(s) ProfileSettings.Aim.CheckTeam = s end)
T_Aim:AddToggle("Verificar Parede", true, function(s) ProfileSettings.Aim.CheckWall = s end)
T_Aim:AddSlider("Suavização", 1, 20, 5, function(v) ProfileSettings.Aim.Smooth = v end)
T_Aim:AddLabel("--- Avançado ---")
T_Aim:AddToggle("Predição", false, function(s) ProfileSettings.Aim.Predict = s end)
T_Aim:AddSlider("Fator de Predição", 1, 30, 16, function(v) ProfileSettings.Aim.PredictValue = v / 100 end)
T_Aim:AddToggle("Travar Alvo (Sticky)", false, function(s) ProfileSettings.Aim.Sticky = s end)

local T_Vis = MainUI:CreateTab("Visuais")
T_Vis:AddToggle("Ativar ESP", false, function(s) ProfileSettings.Visuals.Active = s end)
T_Vis:AddToggle("Caixas (Boxes)", false, function(s) ProfileSettings.Visuals.Box = s end)
T_Vis:AddToggle("Nomes", false, function(s) ProfileSettings.Visuals.Label = s end)
T_Vis:AddToggle("Distância", false, function(s) ProfileSettings.Visuals.Dist = s end)
T_Vis:AddToggle("Linhas (Tracers)", false, function(s) ProfileSettings.Visuals.Line = s end)
T_Vis:AddToggle("Ignorar Aliados", true, function(s) ProfileSettings.Visuals.Team = s end)
T_Vis:AddLabel("--- Aparência ---")
T_Vis:AddToggle("Usar Cor do Time", false, function(s) ProfileSettings.Visuals.TeamColorMode = s end)
T_Vis:AddToggle("Modo Arco-Íris", false, function(s) ProfileSettings.Visuals.RainbowMode = s end)

local T_Scope = MainUI:CreateTab("FOV")
T_Scope:AddToggle("Mostrar Círculo", true, function(s) ProfileSettings.Aim.CircleShow = s end)
T_Scope:AddSlider("Tamanho do Círculo", 50, 800, 100, function(v) ProfileSettings.Aim.CircleSize = v end)

local T_Filters = MainUI:CreateTab("Ignorar Times")
local TeamsS = game:GetService("Teams")
for _, tm in pairs(TeamsS:GetTeams()) do
    T_Filters:AddToggle(tm.Name, false, function(s)
        ProfileSettings.Aim.Blacklist[tm.Name] = s
    end)
end

local T_Settings = MainUI:CreateTab("Configurações")
T_Settings:AddButton("Alvo: Cabeça", function() ProfileSettings.Aim.Part = "Head" end)
T_Settings:AddButton("Alvo: Tronco", function() ProfileSettings.Aim.Part = "HumanoidRootPart" end)
T_Settings:AddLabel("Atalho: Mouse2 (Botão Direito)")

local T_Info = MainUI:CreateTab("Informações")
T_Info:AddLabel("--- [ PT-BR ] ---")
T_Info:AddLabel("Aimbot: Mira automaticamente nos alvos.")
T_Info:AddLabel("Suavização: Deixa o movimento da mira mais natural.")
T_Info:AddLabel("Predição: Mira onde o alvo vai estar (pela velocidade).")
T_Info:AddLabel("Sticky: Não troca de alvo até ele morrer ou sumir.")
T_Info:AddLabel("ESP: Mostra jogadores através das paredes.")
T_Info:AddLabel("Ignorar Times: Escolha times específicos para não mirar.")
T_Info:AddLabel("--- [ EN ] ---")
T_Info:AddLabel("Aimbot: Automatically aims at targets.")
T_Info:AddLabel("Smoothness: Makes aiming motion look more natural.")
T_Info:AddLabel("Prediction: Aims where the target will be (by velocity).")
T_Info:AddLabel("Sticky: Stays on target until they die or disappear.")
T_Info:AddLabel("ESP: Shows players through walls.")
T_Info:AddLabel("Ignore Teams: Select specific teams to not aim at.")
